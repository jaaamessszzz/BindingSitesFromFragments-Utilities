<ROSETTASCRIPTS>

    <SCOREFXNS>
        <ScoreFunction name="sfxn" weights="ref2015"/>
        <ScoreFunction name="sfxn_cst" weights="ref2015_cst"/>
    </SCOREFXNS>

    <RESIDUE_SELECTORS>
        <!--Select Ligand-->
        <Chain name="ligand" chains="X"/>

        <!--Select residues built in by HBNet-->
        <ResiduePDBInfoHasLabel name="hbnet_residues" property="HBNet"/>

        <!--Indicies for matched motif residues, pass in from command line -->
        <Index name="motif_residues" resnums="%%motif_residues%%"/>

        <!--Motif residues and HBNet residues-->
        <Or name="motif_and_HBNet" selectors="motif_residues,hbnet_residues"/>

        <!--Select all residues that will be designed-->
        <Index name="designed" resnums="%%design_positions%%"/>

        <!--Select all residues that aren't in design/pack positions-->
        <Not name="not_packable_positions" selector="designed"/>

    </RESIDUE_SELECTORS>

    <TASKOPERATIONS>
        <!--Get flags from command line: -use_input_sc -flip_HNQ, -no_optH false -->
        <InitializeFromCommandline name="init"/>

        <!--Set HBNet residues to repack only, allows wiggle room within constraint tolerances-->
        <OperateOnResidueSubset name="hbnet_task" selector="hbnet_residues">
           <RestrictToRepackingRLT/>
        </OperateOnResidueSubset>

        <!--Set motif residues to no repack or design-->
        <OperateOnResidueSubset name="motif_task" selector="motif_residues">
           <PreventRepackingRLT/>
        </OperateOnResidueSubset>

        <!--Set ligand to no repack or design-->
        <OperateOnResidueSubset name="fixlig" selector="ligand">
            <PreventRepackingRLT/>
        </OperateOnResidueSubset>

        <!--Set non-designed positions to no repack or design-->
        <OperateOnResidueSubset name="NATRO_positions" selector="not_packable_positions">
            <PreventRepackingRLT/>
        </OperateOnResidueSubset>

        <!--Go HAM on extra rotamers-->
        <ExtraRotamersGeneric name="extra_rots" ex1="True" ex2="True" ex3="True" ex1_sample_level="1" ex2_sample_level="1"
                              ex3_sample_level="1" extrachi_cutoff="0"/>

        <!--Include current rotamers in packer-->
        <IncludeCurrent name="ic" />

        <!--Restrict design to non-PG-->
        <OperateOnResidueSubset name="no_PG" selector="designed">
            <RestrictAbsentCanonicalAASRLT aas="ACDEFHIKLMNQRSTVWY"/>
        </OperateOnResidueSubset>
    </TASKOPERATIONS>

    <xi:include href="../../Filters.xml"/>

    <xi:include href="../../%%design_xml%%"/>

</ROSETTASCRIPTS>