<ROSETTASCRIPTS>

    <SCOREFXNS>
        <ScoreFunction name="sfxn" weights="ref2015"/>
    </SCOREFXNS>

    <RESIDUE_SELECTORS>
        <!--Indicies for matched motif residues, pass in from command line-->
        <Index name="motif_residues" resnums="%%motif_residues%%"/>
        <!--Select Ligand-->
        <Chain name="ligand" chains="X"/>
        <!--Select all residues that aren't design positions-->
        <Not name="outside_design_shell">
            <!--Select design positions from JSON generated by Prep-HB_Design.py -->
            <Index resnums="%%design_positions%%" />
        </Not>
        <!--Select all residues that will not be designed-->
        <Or name="not_designed" selectors="outside_design_shell"/>
    </RESIDUE_SELECTORS>

    <TASKOPERATIONS>
        <!--Get flags from command line: -ex1 -ex2 -use_input_sc -flip_HNQ, -no_optH false -->
        <InitializeFromCommandline name="init"/>
        <!--Set ligand to no repack or design-->
        <OperateOnResidueSubset name="fixlig" selector="ligand">
            <PreventRepackingRLT/>
        </OperateOnResidueSubset>
        <!--Set matched motif residues and all residues outside design shell to no repack or design-->
        <OperateOnResidueSubset name="no_design_or_pack" selector="not_designed">
            <PreventRepackingRLT/>
        </OperateOnResidueSubset>
        <!--Go HAM on extra rotamers-->
        <ExtraRotamersGeneric name="extra_rots" ex1="True" ex2="True" ex1_sample_level="1" ex2_sample_level="1" extrachi_cutoff="0"/>
    </TASKOPERATIONS>

    <FILTERS>
    </FILTERS>

    <MOVERS>
        <HBNet name="hbnet_mover" scorefxn="sfxn" hb_threshold="-0.5" min_network_size="5" max_unsat_Hpol="0" write_network_pdbs="0"
               task_operations="extra_rots,no_design_or_pack,fixlig,init" start_selector="motif_residues"
               monte_carlo="true" max_mc_nets="20" total_num_mc_runs="10000000"/>
        <!--keep_start_selector_rotamers_fixed="True"-->
        <!--use_only_input_rot_for_start_res="True"-->
        <MultiplePoseMover name="MPM_design" max_input_poses="10">
            <xi:include href="Design_Template.xml"/>
        </MultiplePoseMover>
    </MOVERS>

    <APPLY_TO_POSE>
    </APPLY_TO_POSE>

    <PROTOCOLS>
        <Add mover_name="hbnet_mover"/>
        <Add mover_name="MPM_design"/>
    </PROTOCOLS>

</ROSETTASCRIPTS>